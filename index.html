<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAPRO</title>
    <style>
        body { font-family: 'Pretendard', -apple-system, sans-serif; display: flex; margin: 0; height: 100vh; background: #f5f5f5; color: #333; }
        .editor { width: 50%; padding: 30px; overflow-y: auto; border-right: 2px solid #ddd; background: #fff; box-sizing: border-box; }
        h2 { border-bottom: 2px solid #333; padding-bottom: 10px; margin-top: 0; }
        .input-group { margin-bottom: 20px; }
        label { display: block; font-weight: bold; margin-bottom: 8px; font-size: 0.9em; color: #555; }
        
        .tag-row { display: flex; gap: 8px; margin-bottom: 20px; background: #f9f9f9; padding: 15px; border-radius: 8px; }
        .tag-input { flex: 1; border: none; border-bottom: 2px solid #ddd; background: transparent; padding: 5px; font-size: 0.9em; outline: none; transition: 0.3s; }
        .tag-input:focus { border-bottom-color: #4a90e2; }
        
        .hashtag { display: inline-block; background: #eef5ff; color: #4a90e2; padding: 4px 10px; border-radius: 15px; font-size: 0.85em; font-weight: bold; margin-right: 5px; margin-bottom: 10px; }
        .hashtag::before { content: "#"; }

        .search-container { padding: 15px; background: #fff; border-bottom: 1px solid #eee; position: sticky; top: 0; z-index: 10; }
        .search-bar { width: 100%; padding: 10px 15px; outline: none; font-size: 0.9em; box-sizing: border-box; }

        .type-selector { display: flex; gap: 8px; margin-bottom: 15px; }
        .type-btn { flex: 1; padding: 12px; border: 1px solid #ccc; background: #fff; cursor: pointer; border-radius: 4px; font-weight: bold; }
        .type-btn.active { background: #4a90e2; color: white; border-color: #4a90e2; }

        textarea, input[type="text"] { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; font-size: 1em; }
        
        /* ì„ íƒì§€ ìŠ¤íƒ€ì¼ ê°œì„  */
        .option-wrapper { background: #f8f9fa; border: 1px solid #eee; border-radius: 6px; padding: 10px; margin-bottom: 10px; }
        .option-main { display: flex; align-items: center; gap: 10px; margin-bottom: 5px; }
        .option-main span { font-weight: bold; width: 25px; }
        .opt-exp { width: 100%; padding: 8px; border: 1px dashed #ccc; background: #fff; font-size: 0.9em; color: #666; margin-top: 5px; margin-left: 35px; width: calc(100% - 35px); box-sizing: border-box; }
        .opt-exp:focus { border-color: #4a90e2; background: #fff; color: #333; }

        /* ë©”ëª¨ì¥ ìŠ¤íƒ€ì¼ */
        .memo-area { background: #fff9db; border: 1px solid #e6dbb9; color: #555; }

        .btn-save { background: #4a90e2; color: white; width: 100%; padding: 15px; margin: 15px 0; border: none; border-radius: 4px; font-weight: bold; cursor: pointer; }
        .btn-cancel { background: #ff4d4d; color: white; width: 100%; padding: 10px; margin-bottom: 15px; border: none; border-radius: 4px; cursor: pointer; display: none; }
        .action-btns { display: flex; gap: 10px; }
        .btn-secondary { background: #eee; color: #333; flex: 1; padding: 10px; border-radius: 4px; border: none; font-weight: bold; cursor: pointer; }

        .preview-container { width: 50%; display: flex; flex-direction: column; background: #fafafa; }
       /* íƒ­ ì»¨í…Œì´ë„ˆ */
.tabs { 
    display: flex; 
    border-bottom: 1px solid #ddd; 
    background: #fff; 
    position: relative; 
}

.tab { 
    flex: 1; 
    padding: 15px; 
    text-align: center; 
    cursor: pointer; 
    font-weight: bold; 
    color: #999; 
    transition: color 0.3s ease;
    z-index: 1; /* ì¸ë””ì¼€ì´í„°ë³´ë‹¤ ìœ„ì— ì˜¤ë„ë¡ */
}

.tab.active { 
    color: #4a90e2; 
}

/* ì›€ì§ì´ëŠ” íŒŒë€ìƒ‰ ë°‘ì¤„ */
.tab-indicator {
    position: absolute;
    bottom: 0;
    left: 0;
    height: 3px;
    width: 50%; /* íƒ­ì´ 2ê°œì¼ ë•Œ ê¸°ì¤€ */
    background-color: #4a90e2;
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); /* ë¶€ë“œëŸ¬ìš´ ê°€ì†ë„ */
    z-index: 2;
}

/* ì»¨í…ì¸  í˜ì´ë“œ íš¨ê³¼ */
.tab-content { 
    display: none; 
    opacity: 0;
    transition: opacity 0.3s ease;
}

.tab-content.active { 
    display: block; 
    opacity: 1;
}
        .content-padding { padding: 30px; }

        .question-card { background: white; padding: 35px; border: 1px solid #ddd; box-shadow: 0 4px 6px rgba(0,0,0,0.05); position: relative; margin-bottom: 20px; }
        .box-preview { border: 1px solid #333; padding: 15px; margin: 15px 0; background: #fff; position: relative; white-space: pre-wrap; }
        .box-preview::before { content: "<ë³´ ê¸°>"; position: absolute; top: -12px; left: 50%; transform: translateX(-50%); background: white; padding: 0 10px; font-size: 0.9em; font-weight: bold; }
        .preview-img { max-width: 100%; margin: 15px 0; border-radius: 4px; }
        .card-controls { position: absolute; top: 15px; right: 15px; display: flex; gap: 5px; }
        .control-btn { cursor: pointer; background: #f0f0f0; border: none; padding: 4px 8px; border-radius: 4px; font-size: 0.75em; color: #555; }

        /* ë¯¸ë¦¬ë³´ê¸°ì—ì„œì˜ í•´ì„¤/ë©”ëª¨ ìŠ¤íƒ€ì¼ */
        .preview-exp { font-size: 0.85em; color: #666; margin-left: 20px; margin-top: 2px; display: block; background: #f1f1f1; padding: 4px 8px; border-radius: 4px; width: fit-content; }
        .preview-memo { margin-top: 20px; padding: 15px; background: #fffbe6; border-left: 4px solid #ffd700; font-size: 0.9em; color: #555; white-space: pre-wrap; }
        .preview-memo strong { display: block; margin-bottom: 5px; color: #d4a017; }
        /* ì„ íƒí˜• ë³´ê¸°(ã„±,ã„´,ã„·) ì…ë ¥ í–‰ ìŠ¤íƒ€ì¼ */
        .item-row { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; background: #fff; padding: 8px; border: 1px solid #eee; border-radius: 6px; }
        .item-label { font-weight: bold; color: #4a90e2; width: 25px; text-align: center; }
        .item-input { flex: 2; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 0.95em; }
        .item-alt { flex: 1; padding: 8px; border: 1px dashed #ccc; border-radius: 4px; font-size: 0.9em; background: #fdfdfd; }
        
.ox-switch {
    position: relative; width: 50px; height: 26px;
    background: #ccc; border-radius: 20px; transition: 0.3s;
    cursor: pointer; user-select: none; display: inline-block; vertical-align: middle;
}
.ox-switch.is-o { background: #4CAF50; } /* O: ì´ˆë¡ìƒ‰ */
.ox-switch.is-x { background: #ff5252; } /* X: ë¹¨ê°„ìƒ‰ */

.ox-knob {
    position: absolute; top: 3px; left: 3px;
    width: 20px; height: 20px; background: white; border-radius: 50%;
    transition: 0.3s; display: flex; align-items: center; justify-content: center;
    font-size: 12px; font-weight: bold; color: #555;
}
.ox-switch.is-o .ox-knob { left: 27px; color: #4CAF50; content: "O"; }
.ox-switch.is-x .ox-knob { left: 3px; color: #ff5252; content: "X"; }

/* [ì¶”ê°€] AI ë²„íŠ¼ ë° íœ´ì§€í†µ ìŠ¤íƒ€ì¼ */
.btn-ai { 
    background: linear-gradient(135deg, #667eea, #764ba2); color: white; 
    border: none; padding: 5px 10px; border-radius: 4px; font-size: 0.8em; 
    cursor: pointer; margin-left: 5px; 
}
.btn-ai:hover { opacity: 0.9; }

.btn-trash { 
    background: none; border: none; font-size: 1.2em; cursor: pointer; 
    color: #bbb; padding: 5px; margin-left: auto; 
}
.btn-trash:hover { color: red; }

/* [ì¶”ê°€] API í‚¤ ì…ë ¥ì¹¸ ìŠ¤íƒ€ì¼ */
.api-section { background: #e8f0fe; border: 1px solid #cce5ff; padding: 10px; margin-bottom: 20px; border-radius: 6px; }
    </style>
    <script src="config.js"></script>
</head>
<body>

<div class="editor">
    <h2 id="editor-title">MAPRO í¸ì§‘ê¸°</h2>
    
    <div class="tag-row">
        <input type="text" id="subject" class="tag-input" placeholder="ê³¼ëª©ëª…">
        <input type="text" id="year" class="tag-input" placeholder="ì—°ë„">
        <input type="text" id="month" class="tag-input" placeholder="ì›”">
        <input type="text" id="q-number" class="tag-input" placeholder="ë²ˆí˜¸">
    </div>

    <div class="input-group">
        <label>ë¬¸ì œ ìœ í˜• ì„ íƒ</label>
        <div class="type-selector">
            <button class="type-btn active" id="btn-multiple" onclick="setMainType('multiple')">ì˜¤ì§€ì„ ë‹¤í˜•</button>
            <button class="type-btn" id="btn-short" onclick="setMainType('short')">ë‹¨ë‹µí˜•</button>
        </div>
        <div id="box-option-toggle" style="margin-top: 10px;">
            <label style="display: flex; align-items: center; font-weight: normal; cursor: pointer;">
                <input type="checkbox" id="use-box" onchange="toggleBoxInput()"> <span style="margin-left: 8px;">ë³´ê¸°(ë°•ìŠ¤) ì¶”ê°€í•˜ê¸°</span>
            </label>
        </div>
    </div>

    <div class="input-group">
        <label>ë¬¸ì œ ì§€ë¬¸</label>
        <textarea id="question-text" rows="3" placeholder="ë¬¸ì œë¥¼ ì…ë ¥í•˜ì„¸ìš”."></textarea>
    </div>
    <div id="box-input-area" class="input-group" style="display: none; background: #f8f9fa; padding: 15px; border-radius: 8px; border: 1px solid #eee;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
        <label style="margin-bottom: 0;">ë³´ê¸° ë°•ìŠ¤ ìœ í˜•</label>
        <div style="display: flex; gap: 10px; align-items: center;">
            <label style="font-weight: normal; cursor: pointer;">
                <input type="radio" name="boxType" value="text" checked onchange="toggleBoxMode()"> ğŸ“„ ì¤„ê¸€(ì§€ë¬¸)
            </label>
            <label style="font-weight: normal; cursor: pointer;">
                <input type="radio" name="boxType" value="items" onchange="toggleBoxMode()"> â˜‘ï¸ ì„ íƒí˜•(ã„±,ã„´,ã„·)
            </label>
        </div>
    </div>

    <div id="mode-text">
        <textarea id="box-content-text" rows="6" placeholder="ì§€ë¬¸ì´ë‚˜ ì°¸ê³  ìë£Œ ë‚´ìš©ì„ ììœ ë¡­ê²Œ ì…ë ¥í•˜ì„¸ìš”." oninput="updatePreview()"></textarea>
    </div>

    <div id="mode-items" style="display: none;">
        <div style="text-align: right; margin-bottom: 10px;">
             <button class="btn-shuffle" onclick="shuffleAndSyncAnswer()">ì…”í”Œ</button>
        </div>
        
        <div id="items-container"></div>
        
        <button class="btn-add-row" onclick="addItemRow()">+ ë³´ê¸° í•­ëª© ì¶”ê°€í•˜ê¸°</button>
    </div>
</div>

    <div class="input-group">
        <label>ì´ë¯¸ì§€ ì—…ë¡œë“œ (ì„ íƒ)</label>
        <input type="file" id="image-input" accept="image/*">
    </div>

    <div id="options-area" class="input-group">
        <label>ì„ íƒì§€ ë° í•´ì„¤(ê·¼ê±°) ì‘ì„±</label>
        <div class="options">
            <div class="option-wrapper">
                <div class="option-main">
                    <input type="radio" name="correct" value="0"> <span>â‘ </span>
                    <input type="text" class="opt" placeholder="ë³´ê¸° 1 ë‚´ìš©">
                </div>
                <input type="text" class="opt-exp" placeholder="â”” â‘ ë²ˆ ì„ íƒì§€ì— ëŒ€í•œ í•´ì„¤/ê·¼ê±° (AI í•™ìŠµìš© ë°ì´í„°)">
            </div>
            <div class="option-wrapper">
                <div class="option-main">
                    <input type="radio" name="correct" value="1"> <span>â‘¡</span>
                    <input type="text" class="opt" placeholder="ë³´ê¸° 2 ë‚´ìš©">
                </div>
                <input type="text" class="opt-exp" placeholder="â”” â‘¡ë²ˆ ì„ íƒì§€ì— ëŒ€í•œ í•´ì„¤/ê·¼ê±°">
            </div>
            <div class="option-wrapper">
                <div class="option-main">
                    <input type="radio" name="correct" value="2"> <span>â‘¢</span>
                    <input type="text" class="opt" placeholder="ë³´ê¸° 3 ë‚´ìš©">
                </div>
                <input type="text" class="opt-exp" placeholder="â”” â‘¢ë²ˆ ì„ íƒì§€ì— ëŒ€í•œ í•´ì„¤/ê·¼ê±°">
            </div>
            <div class="option-wrapper">
                <div class="option-main">
                    <input type="radio" name="correct" value="3"> <span>â‘£</span>
                    <input type="text" class="opt" placeholder="ë³´ê¸° 4 ë‚´ìš©">
                </div>
                <input type="text" class="opt-exp" placeholder="â”” â‘£ë²ˆ ì„ íƒì§€ì— ëŒ€í•œ í•´ì„¤/ê·¼ê±°">
            </div>
            <div class="option-wrapper">
                <div class="option-main">
                    <input type="radio" name="correct" value="4"> <span>â‘¤</span>
                    <input type="text" class="opt" placeholder="ë³´ê¸° 5 ë‚´ìš©">
                </div>
                <input type="text" class="opt-exp" placeholder="â”” â‘¤ë²ˆ ì„ íƒì§€ì— ëŒ€í•œ í•´ì„¤/ê·¼ê±°">
            </div>
        </div>
    </div>

    <div id="short-input-area" class="input-group" style="display: none;">
        <label>ë‹¨ë‹µí˜• ì •ë‹µ</label>
        <input type="text" id="short-answer" placeholder="ì •ë‹µì„ ì…ë ¥í•˜ì„¸ìš”.">
    </div>

    <div class="input-group">
        <label>ì„ ìƒë‹˜ ë©”ëª¨ (ì¶œì œ ì˜ë„ / ì „ì²´ í•´ì„¤)</label>
        <textarea id="teacher-memo" class="memo-area" rows="3" placeholder="ì´ ë¬¸ì œì˜ í•µì‹¬ í¬ì¸íŠ¸ë‚˜ ì „ì²´ì ì¸ í•´ì„¤ì„ ì ì–´ì£¼ì„¸ìš”."></textarea>
    </div>

    <button id="btn-save" class="btn-save" onclick="saveQuestion()">+ ë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€í•˜ê¸°</button>
    <button id="btn-cancel" class="btn-cancel" onclick="cancelEdit()">ìˆ˜ì • ì·¨ì†Œ</button>

    <div class="action-btns">
        <button class="btn-secondary" onclick="downloadJSON()">JSON ì €ì¥ (AIìš©)</button>
        <button class="btn-secondary" onclick="document.getElementById('file-loader').click()">ë¶ˆëŸ¬ì˜¤ê¸°</button>
    </div>
    <input type="file" id="file-loader" style="display:none" onchange="loadJSON(event)">
</div>

<div class="preview-container">
    <div class="tabs">
        <div id="t-live" class="tab active" onclick="switchTab('live')">ì‹¤ì‹œê°„ ë¯¸ë¦¬ë³´ê¸°</div>
        <div id="t-list" class="tab" onclick="switchTab('list')">ì „ì²´ ë¦¬ìŠ¤íŠ¸ (<span id="q-count">0</span>)</div>
        <div class="tab-indicator" id="indicator"></div>
    </div>

    <div id="tab-live" class="tab-content active">
        <div class="content-padding">
            <div class="question-card">
                <div id="p-tags"></div>
                <div id="p-question" style="font-size: 1.1em; font-weight: bold; white-space: pre-wrap;">ë¬¸ì œë¥¼ ì…ë ¥í•˜ì„¸ìš”.</div>
                <img id="p-image" class="preview-img" style="display: none;">
                <div id="p-box" class="box-preview" style="display:none;"></div>
                
                <div id="p-options-area" style="margin-top:15px;"><ul id="p-options" style="list-style:none; padding:0;"></ul></div>
                <div id="p-short-area" style="display:none; margin-top:15px; padding:10px; background:#f0f0f0; border-radius:4px;"><strong>ì •ë‹µ:</strong> <span id="p-short-ans"></span></div>
                
                <div id="p-memo" class="preview-memo" style="display:none;"></div>
            </div>
        </div>
    </div>

    <div id="tab-list" class="tab-content">
    <div class="search-bar" style="margin-bottom:20px; display:flex; gap:10px;">
        <input type="text" id="search-input" placeholder="ë¬¸ì œ ë‚´ìš©, ê³¼ëª©, ì—°ë„ ê²€ìƒ‰..." 
               onkeyup="filterQuestions()" style="flex:1; padding:8px;">
    </div>
    <div id="question-list">
        </div>
</div>
</div>

<script>
    let questions = [];
    let currentMainType = 'multiple'; 
    let currentImage = "";
    let editingId = null;
    const fields = ['subject', 'year', 'month', 'q-number'];
    const labels = ['ã„±', 'ã„´', 'ã„·', 'ã„¹', 'ã…', 'ã…‚',' ã……', 'ã…‡', 'ã…ˆ', 'ã…Š', 'ã…‹', 'ã…Œ', 'ã…', 'ã…'];
    let shuffledBoxData = null;

    function setMainType(type) {
        currentMainType = type;
        document.getElementById('btn-multiple').classList.toggle('active', type === 'multiple');
        document.getElementById('btn-short').classList.toggle('active', type === 'short');
        document.getElementById('box-option-toggle').style.display = (type === 'multiple' ? 'block' : 'none');
        document.getElementById('options-area').style.display = (type === 'multiple' ? 'block' : 'none');
        document.getElementById('short-input-area').style.display = (type === 'short' ? 'block' : 'none');
        if(type === 'short') { 
            document.getElementById('use-box').checked = false; 
            toggleBoxInput(); 
        }
        updatePreview();
    }

    function toggleBoxInput() {
        const useBox = document.getElementById('use-box').checked;
        const area = document.getElementById('box-input-area');
        if(area) area.style.display = useBox ? 'block' : 'none';
        if(useBox) toggleBoxMode();
        updatePreview();
    }

    function toggleBoxMode() {
        const boxType = document.querySelector('input[name="boxType"]:checked')?.value || 'text';
        const modeText = document.getElementById('mode-text');
        const modeItems = document.getElementById('mode-items');
        
        if (boxType === 'items') {
            modeText.style.display = 'none';
            modeItems.style.display = 'block';
            if(document.getElementById('items-container').children.length === 0) {
                addItemRow(); addItemRow(); addItemRow();
            }
        } else {
            modeText.style.display = 'block';
            modeItems.style.display = 'none';
        }
        updatePreview();
    }

    // 2. í•­ëª©(Row) ê´€ë¦¬ ë° O/X
    function addItemRow(data = null) {
    const container = document.getElementById('items-container');
    const currentIndex = container.children.length;
    
    const row = document.createElement('div');
    row.className = 'item-row';
    row.dataset.idx = currentIndex;

    const hideDel = currentIndex < 3 ? 'visibility:hidden;' : '';
    
    // ë°ì´í„°ê°€ ìˆìœ¼ë©´ í•´ë‹¹ ê°’ìœ¼ë¡œ, ì—†ìœ¼ë©´ ë¹ˆ ê°’ìœ¼ë¡œ ì„¤ì •
    const mainVal = data ? (data.text || data.original || "") : "";
    const altVal = data ? (data.alt || "") : "";
    const mainIsO = data ? (data.isCorrect === true) : true; 

    row.innerHTML = `
        <div class="item-label" style="font-weight:bold; width:30px; padding-top:8px;">${labels[currentIndex]}</div>
        <div style="flex:1;">
            <div style="display:flex; align-items:center; margin-bottom:5px;">
                <input type="text" class="main-text" value="${mainVal}" placeholder="ì›ë³¸ ë³´ê¸° ë‚´ìš©" oninput="updatePreview()" style="flex:1;">
                <div class="ox-switch ox-main ${mainIsO ? 'is-o' : 'is-x'}" onclick="toggleOX(this)" style="margin:0 8px;">
                    <div class="ox-knob">${mainIsO ? 'O' : 'X'}</div>
                </div>
                <button class="btn-ai" onclick="generateVariant(${currentIndex})">AI ë³€í˜•</button>
            </div>
            <div style="display:flex; align-items:center; background:#f0f7ff; padding:5px; border-radius:4px;">
                <span style="color:#999; font-size:0.8em; margin-right:5px;">â†³ ë³€í˜•</span>
                <input type="text" class="alt-text" value="${altVal}" placeholder="ë³€í˜• ë¬¸êµ¬ (AI ìë™ ìƒì„±)" oninput="updatePreview()" style="flex:1;">
                <div class="ox-switch ox-alt ${!mainIsO ? 'is-o' : 'is-x'}" onclick="toggleOX(this)" style="margin-left:8px;">
                    <div class="ox-knob">${!mainIsO ? 'O' : 'X'}</div>
                </div>
            </div>
        </div>
        <button class="btn-trash" style="${hideDel}" onclick="deleteRow(this)">ğŸ—‘ï¸</button>
    `;
    container.appendChild(row);
}

    function deleteRow(btn) {
        btn.closest('.item-row').remove();
        document.querySelectorAll('.item-row').forEach((r, i) => {
            r.querySelector('.item-label').innerText = labels[i];
        });
        updatePreview();
    }

    function toggleOX(el) {
    const knob = el.querySelector('.ox-knob');
    
    // í˜„ì¬ ìƒíƒœ ë°˜ì „
    if (el.classList.contains('is-o')) {
        el.classList.remove('is-o');
        el.classList.add('is-x');
        knob.innerText = 'X';
    } else {
        el.classList.remove('is-x');
        el.classList.add('is-o');
        knob.innerText = 'O';
    }

    // [ìŠ¤ë§ˆíŠ¸ ì—°ë™] ì›ë³¸(ox-main)ì„ ë°”ê¾¸ë©´ ë³€í˜•(ox-alt)ì€ ìë™ìœ¼ë¡œ ë°˜ëŒ€ê°’ ì„¸íŒ…
    if(el.classList.contains('ox-main')) {
        const row = el.closest('.item-row');
        const altSwitch = row.querySelector('.ox-alt');
        const altKnob = altSwitch.querySelector('.ox-knob');
        
        if (el.classList.contains('is-o')) {
            altSwitch.classList.replace('is-o', 'is-x');
            altKnob.innerText = 'X';
        } else {
            altSwitch.classList.replace('is-x', 'is-o');
            altKnob.innerText = 'O';
        }
    }
    updatePreview();
}
async function generateVariant(idx) {
    const API_KEY = CONFIG.OPENAI_API_KEY;
    const row = document.querySelector(`.item-row[data-idx="${idx}"]`);
    const mainText = row.querySelector('.main-text').value;
    const mainIsO = row.querySelector('.ox-main').classList.contains('is-o');

    if (!mainText) return alert("ì›ë³¸ ë³´ê¸° ë‚´ìš©ì„ ë¨¼ì € ì…ë ¥í•˜ì„¸ìš”.");

    const btn = row.querySelector('.btn-ai');
    btn.innerText = "ìƒì„± ì¤‘...";
    btn.disabled = true;

    try {
        const response = await fetch("https://api.openai.com/v1/chat/completions", {
            method: "POST",
            headers: { "Content-Type": "application/json", "Authorization": `Bearer ${API_KEY}` },
            body: JSON.stringify({
                model: "gpt-3.5-turbo",
                messages: [
                    { role: "system", content: "You are an exam expert. Create a variation sentence with the opposite truth value. Reply ONLY in JSON: {\"text\": \"...\", \"isCorrect\": boolean}" },
                    { role: "user", content: `Original: "${mainText}". It is ${mainIsO ? 'True' : 'False'}.` }
                ]
            })
        });
        const data = await response.json();
        const result = JSON.parse(data.choices[0].message.content);

        const altInput = row.querySelector('.alt-text');
        const altSwitch = row.querySelector('.ox-alt');
        const altKnob = altSwitch.querySelector('.ox-knob');

        // AI ê²°ê³¼ ë¬¸êµ¬ ì‚½ì…
        altInput.value = result.text;

        // [í•µì‹¬] AIê°€ íŒë‹¨í•œ ì°¸/ê±°ì§“(result.isCorrect)ì„ ìŠ¤ìœ„ì¹˜ UIì— ë°˜ì˜
        if (result.isCorrect) {
            altSwitch.classList.remove('is-x');
            altSwitch.classList.add('is-o');
            altKnob.innerText = "O";
        } else {
            altSwitch.classList.remove('is-o');
            altSwitch.classList.add('is-x');
            altKnob.innerText = "X";
        }
        
        updatePreview();
    } catch (e) { 
        alert("AI ìƒì„± ì‹¤íŒ¨: í‚¤ë¥¼ í™•ì¸í•˜ì„¸ìš”."); 
    } finally { 
        btn.innerText = "âš¡AI ë³€í˜•"; btn.disabled = false; 
    }
}

function shuffleAndSyncAnswer() {
    // 1. í˜„ì¬ ì…ë ¥ëœ ë°ì´í„° ìˆ˜ì§‘ (ì…ë ¥ì°½ UIëŠ” ê±´ë“œë¦¬ì§€ ì•ŠìŒ)
    const rows = Array.from(document.querySelectorAll('.item-row'));
    let processedItems = [];
    let previewTexts = []; // ë¯¸ë¦¬ë³´ê¸° ë°•ìŠ¤ ì „ìš© ë°°ì—´

    rows.forEach((row, idx) => {
        const mainInput = row.querySelector('.main-text');
        const altInput = row.querySelector('.alt-text');
        
        const mainText = mainInput.value.trim();
        const altText = altInput ? altInput.value.trim() : "";
        
        // í´ë˜ìŠ¤ëª…(ox-main, ox-alt)ì€ ì„ ìƒë‹˜ì˜ í™˜ê²½ì— ë§ì¶° í™•ì¸ í•„ìš”
        const mainIsO = row.querySelector('.ox-main')?.classList.contains('is-o');
        const altIsO = row.querySelector('.ox-alt')?.classList.contains('is-o');

        if (mainText) {
            // ì›ë³¸ê³¼ ë³€í˜• ì¤‘ ëœë¤ ì„ íƒ (ë³€í˜•ì´ ìˆì„ ë•Œë§Œ 50% í™•ë¥ )
            const useAlt = altText && Math.random() > 0.5;
            const chosenText = useAlt ? altText : mainText;
            const chosenIsCorrect = useAlt ? altIsO : mainIsO;

            // ì„ ì§€ ì¡°í•© ê³„ì‚°ìš© ë°ì´í„°
            processedItems.push({
                text: chosenText,
                isCorrect: chosenIsCorrect,
                label: labels[idx]
            });

            // ë¯¸ë¦¬ë³´ê¸° ë°•ìŠ¤(ã„±, ã„´, ã„·) êµ¬ì„± ë°ì´í„°
            previewTexts.push(`${labels[idx]}. ${chosenText}`);
        }
    });

    if (processedItems.length < 1) return alert("ë³´ê¸°ë¥¼ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”.");

    // [í•µì‹¬] ì…ë ¥ì°½ì€ ìœ ì§€í•˜ê³ , ë¯¸ë¦¬ë³´ê¸°ìš© ë³€ìˆ˜ë§Œ ì—…ë°ì´íŠ¸
    shuffledBoxData = previewTexts.join('\n');

    // 2. ì •ë‹µ ë¼ë²¨ ì¶”ì¶œ (ì˜ˆ: "ã„±, ã„·")
    const correctLabels = processedItems
        .filter(it => it.isCorrect)
        .map(it => it.label)
        .sort((a, b) => labels.indexOf(a) - labels.indexOf(b));
    
    const correctStr = correctLabels.length > 0 ? correctLabels.join(', ') : "ì •ë‹µ ì—†ìŒ";

    // 3. ì„ ì§€ í›„ë³´êµ° ìƒì„± (ì •ë‹µ í¬í•¨ ì´ 5ê°œ ëœë¤ ì¡°í•©)
    const availableLabels = labels.slice(0, processedItems.length);
    let comboSet = new Set();
    comboSet.add(correctStr); 
    
    let attempts = 0;
    while(comboSet.size < 5 && attempts < 200) {
        let count = Math.floor(Math.random() * availableLabels.length) + 1;
        let randomCombo = [...availableLabels]
            .sort(() => Math.random() - 0.5)
            .slice(0, count)
            .sort((a, b) => labels.indexOf(a) - labels.indexOf(b))
            .join(', ');
            
        if(randomCombo) comboSet.add(randomCombo);
        attempts++;
    }
    
    // 4. ì„ ì§€ ìœ„ì¹˜ ëœë¤í™” ë° UI ë°˜ì˜
    let finalOptions = Array.from(comboSet).sort(() => Math.random() - 0.5);
    
    const optionInputs = document.querySelectorAll('.opt');
    const radios = document.querySelectorAll('input[name="correct"]');
    
    optionInputs.forEach(input => input.value = "");
    radios.forEach(r => r.checked = false);

    finalOptions.forEach((optText, idx) => {
        if(idx < 5) {
            optionInputs[idx].value = optText;
            if(optText === correctStr) radios[idx].checked = true;
        }
    });

    // 5. ë¯¸ë¦¬ë³´ê¸° ê°±ì‹  (updatePreview ë‚´ë¶€ì—ì„œ shuffledBoxDataë¥¼ ì°¸ì¡°í•¨)
    updatePreview();
}

    // 4. ì €ì¥ / ìˆ˜ì • / ë³µì‚¬
    function saveQuestion() {
        const text = document.getElementById('question-text').value.trim();
        if (!text) return alert("ë¬¸ì œë¥¼ ì…ë ¥í•˜ì„¸ìš”.");

        const useBox = document.getElementById('use-box').checked;
        const boxType = document.querySelector('input[name="boxType"]:checked')?.value || 'text';
        let smartData = "";

        if (useBox) {
            if (boxType === 'text') {
                smartData = document.getElementById('box-content-text').value;
            } else {
                const rows = Array.from(document.querySelectorAll('.item-row'));
                smartData = JSON.stringify(rows.map(row => ({
                    text: row.querySelector('.main-text').value,
                    alt: row.querySelector('.alt-text').value,
                    isCorrect: row.querySelector('.btn-ox').innerText === 'O'
                })));
            }
        }

        let data = {
            id: editingId || Date.now(),
            mainType: currentMainType,
            useBox: useBox, boxType: boxType, text: text,
            smartBoxData: smartData, image: currentImage,
            image: currentImage,
            memo: document.getElementById('teacher-memo').value,
            tags: {
                subject: document.getElementById('subject').value,
                year: document.getElementById('year').value,
                month: document.getElementById('month').value,
                number: document.getElementById('q-number').value
            }
        };

        if (currentMainType === 'multiple') {
            data.options = Array.from(document.querySelectorAll('.opt')).map(i => i.value.trim());
            data.correct = Array.from(document.querySelectorAll('input[name="correct"]')).findIndex(r => r.checked);
        } else {
            data.answer = document.getElementById('short-answer').value.trim();
        }

        if (editingId) {
            const idx = questions.findIndex(q => q.id === editingId);
            if(idx !== -1) questions[idx] = data;
        } else { questions.push(data); }

        resetForm(); updatePreview(); switchTab('list');
    }

    function editQuestion(id) {
        const q = questions.find(item => item.id === id);
        if (!q) return;
        editingId = id;
        fillForm(q, "âœ… ìˆ˜ì • ì™„ë£Œ");
    }

    function copyQuestion(id) {
        const q = questions.find(item => item.id === id);
        if (!q) return;
        editingId = null; // ë³µì‚¬ëŠ” ìƒˆ IDë¡œ ì €ì¥ë˜ê²Œ í•¨
        fillForm(q, "+ ë³µì‚¬ë³¸ ì¶”ê°€");
    }

    function fillForm(q, btnText) {
    document.getElementById('editor-title').innerText = "í¸ì§‘ ì¤‘";
    document.getElementById('btn-save').innerText = btnText;
    document.getElementById('btn-cancel').style.display = "block";
    
    // ê¸°ë³¸ ì •ë³´ ì±„ìš°ê¸°
    fields.forEach(f => {
        const el = document.getElementById(f);
        if(el) el.value = q.tags[f === 'q-number' ? 'number' : f] || '';
    });

    setMainType(q.mainType);
    
    // ë¬¸ì œ í…ìŠ¤íŠ¸ (id í˜¸í™˜ì„± ì²˜ë¦¬)
    const qTextEl = document.getElementById('question-text') || document.getElementById('q-text');
    if(qTextEl) qTextEl.value = q.text || "";

    document.getElementById('use-box').checked = q.useBox;
    
    const boxRadios = document.getElementsByName('boxType');
    for (let r of boxRadios) { r.checked = (r.value === (q.boxType || 'text')); }
    
    toggleBoxInput();

    // [ì¤‘ìš”] ë³´ê¸° ë°ì´í„° ë³µì›
    if (q.useBox) {
        if (q.boxType === 'items' && q.smartBoxData) {
            const container = document.getElementById('items-container');
            container.innerHTML = '';
            try {
                const items = typeof q.smartBoxData === 'string' ? JSON.parse(q.smartBoxData) : q.smartBoxData;
                items.forEach(item => addItemRow(item));
            } catch (e) { 
                console.error("ë³´ê¸° ë³µì› ì‹¤íŒ¨:", e); 
            }
        } else {
            const boxTextEl = document.getElementById('box-content-text');
            if(boxTextEl) boxTextEl.value = q.smartBoxData || "";
        }
    }

    // ì„ ì§€ ì±„ìš°ê¸°
    if (q.mainType === 'multiple' && q.options) {
        const optInputs = document.querySelectorAll('.opt');
        const radios = document.querySelectorAll('input[name="correct"]');
        q.options.forEach((val, i) => { 
            if(optInputs[i]) optInputs[i].value = val; 
            if(radios[i]) radios[i].checked = (i === q.correct);
        });
    } else {
        const shortAnsEl = document.getElementById('short-answer');
        if(shortAnsEl) shortAnsEl.value = q.answer || '';
    }

    document.getElementById('teacher-memo').value = q.memo || '';
    updatePreview(); 
    switchTab('live');
}

    // 5. ìœ í‹¸ë¦¬í‹° (ë¯¸ë¦¬ë³´ê¸°, ë¦¬ìŠ¤íŠ¸, íŒŒì¼)
    function resetForm() {
        editingId = null;
        document.getElementById('editor-title').innerText = "MAPRO í¸ì§‘ê¸°";
        document.getElementById('btn-save').innerText = "+ ë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€í•˜ê¸°";
        document.getElementById('btn-cancel').style.display = "none";
        fields.forEach(f => document.getElementById(f).value = '');
        document.getElementById('question-text').value = '';
        document.getElementById('use-box').checked = false;
        toggleBoxInput();
        document.getElementById('items-container').innerHTML = '';
        currentImage = '';
        document.getElementById('p-image').style.display = 'none';
        document.querySelectorAll('.opt').forEach(i => i.value = '');
        document.querySelectorAll('input[name="correct"]').forEach(r => r.checked = false);
        document.getElementById('short-answer').value = '';
        document.getElementById('teacher-memo').value = '';
    }
// í–‰ ì‚­ì œ í•¨ìˆ˜ ìˆ˜ì •
function deleteRow(btn) {
    // [ì¶”ê°€] confirm ì°½ìœ¼ë¡œ ì‚¬ìš©ì í™•ì¸
    if (confirm("ì´ ë³´ê¸°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
        const row = btn.closest('.item-row');
        row.remove();
        
        // ê¸°í˜¸(ã„±,ã„´,ã„·) ìˆœì„œ ì¬ì •ë ¬
        const rows = document.querySelectorAll('.item-row');
        rows.forEach((r, i) => {
            const labelSpan = r.querySelector('.item-label');
            if (labelSpan) {
                labelSpan.innerText = labels[i];
            }
        });
        
        // ë¯¸ë¦¬ë³´ê¸° ì‹¤ì‹œê°„ ë°˜ì˜
        updatePreview();
    }
}
 function updatePreview() {
    // 1. ê¸°ë³¸ ì •ë³´ ë° ë¬¸ì œ í…ìŠ¤íŠ¸
    const qTextEl = document.getElementById('question-text') || document.getElementById('q-text');
    const pQuestion = document.getElementById('p-question');
    if(pQuestion) pQuestion.innerText = qTextEl?.value || "ë¬¸ì œë¥¼ ì…ë ¥í•˜ì„¸ìš”.";

    const pTags = document.getElementById('p-tags');
    if(pTags) {
        pTags.innerHTML = '';
        fields.forEach(f => {
            const el = document.getElementById(f);
            if(el?.value) {
                const span = document.createElement('span');
                span.className = 'hashtag';
                span.innerText = el.value;
                pTags.appendChild(span);
            }
        });
    }

    // 2. ì´ë¯¸ì§€
    const pImg = document.getElementById('p-image');
    if (pImg) {
        pImg.src = currentImage || "";
        pImg.style.display = currentImage ? 'block' : 'none';
    }

    // 3. ë°•ìŠ¤(ë³´ê¸°) ì—…ë°ì´íŠ¸ - [ì…”í”Œ ë°ì´í„° ìš°ì„  ë¡œì§]
    const pBox = document.getElementById('p-box');
    const useBox = document.getElementById('use-box')?.checked;
    const boxType = document.querySelector('input[name="boxType"]:checked')?.value;

    if(pBox) {
        if(useBox) {
            let content = "";
            if (boxType === 'text') {
                content = document.getElementById('box-content-text')?.value || "";
            } else {
                // ì…”í”Œëœ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ê·¸ê²ƒì„ ë³´ì—¬ì£¼ê³ , ì—†ìœ¼ë©´ ì‹¤ì‹œê°„ ì…ë ¥ì°½ ë‚´ìš© ì‚¬ìš©
                if (shuffledBoxData) {
                    content = shuffledBoxData;
                } else {
                    const rows = document.querySelectorAll('.item-row');
                    content = Array.from(rows).map((row, i) => {
                        const txt = row.querySelector('.main-text')?.value.trim();
                        return txt ? `${labels[i]}. ${txt}` : null;
                    }).filter(t => t).join('\n');
                }
            }
            pBox.innerHTML = content.replace(/\n/g, '<br>');
            pBox.style.display = content ? 'block' : 'none';
        } else { 
            pBox.style.display = 'none'; 
        }
    }

    // 4. ì„ ì§€ ì—…ë°ì´íŠ¸
    const pOptions = document.getElementById('p-options');
    if (pOptions) {
        if (currentMainType === 'multiple') {
            const optInputs = document.querySelectorAll('.opt');
            const radios = document.querySelectorAll('input[name="correct"]');
            const labelsNum = ['â‘ ', 'â‘¡', 'â‘¢', 'â‘£', 'â‘¤'];
            let html = "";
            optInputs.forEach((input, i) => {
                if (input.value.trim()) {
                    const isCorrect = radios[i]?.checked;
                    const style = isCorrect ? 'color: red; font-weight: bold;' : '';
                    html += `<div style="${style}">${labelsNum[i]} ${input.value}</div>`;
                }
            });
            pOptions.innerHTML = html;
        } else {
            const ans = document.getElementById('short-answer')?.value;
            pOptions.innerHTML = ans ? `<b>ì •ë‹µ: ${ans}</b>` : '';
        }
    }

    // 5. ë©”ëª¨
    const pMemo = document.getElementById('p-memo');
    const memoVal = document.getElementById('teacher-memo')?.value;
    if(pMemo) {
        pMemo.innerHTML = memoVal ? `<strong>ğŸ“ í•´ì„¤</strong><br>${memoVal.replace(/\n/g, '<br>')}` : '';
        pMemo.style.display = memoVal ? 'block' : 'none';
    }
}

    // 1. ê²€ìƒ‰ ê¸°ëŠ¥ (ì „ì—­ ë³€ìˆ˜ë¡œ ê´€ë¦¬)
function filterQuestions() {
    const searchTerm = document.getElementById('search-input')?.value.toLowerCase() || "";
    renderList(searchTerm);
}

// 2. ë¦¬ìŠ¤íŠ¸ ë Œë”ë§ í•¨ìˆ˜ (ê°•í™” ë²„ì „)
function renderList(searchTerm = "") {
    const container = document.getElementById('question-list');
    if (!container) return;

    // ê²€ìƒ‰ì–´ í•„í„°ë§ ë¡œì§
    const filtered = questions.filter(q => {
        const textMatch = q.text.toLowerCase().includes(searchTerm);
        const subjectMatch = q.tags.subject.toLowerCase().includes(searchTerm);
        const yearMatch = q.tags.year.includes(searchTerm);
        const memoMatch = q.memo.toLowerCase().includes(searchTerm);
        return textMatch || subjectMatch || yearMatch || memoMatch;
    });

    container.innerHTML = filtered.length === 0 ? '<p style="padding:20px; text-align:center; color:#999;">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ê±°ë‚˜ ë“±ë¡ëœ ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤.</p>' : '';

    filtered.forEach((q, index) => {
        const card = document.createElement('div');
        card.className = 'question-card';
        card.style = "border:1px solid #ddd; padding:15px; margin-bottom:20px; border-radius:8px; background:#fff; position:relative;";

        // ì •ë‹µ í…ìŠ¤íŠ¸ ê°€ê³µ
        const ansLabel = q.mainType === 'multiple' 
            ? (['â‘ ','â‘¡','â‘¢','â‘£','â‘¤'][q.correct] || 'ë¯¸ì²´í¬') 
            : q.answer;

        // ë³´ê¸°(Box) ë‚´ìš© ê°€ê³µ
        let boxHTML = "";
        if (q.useBox && q.smartBoxData) {
            let boxContent = "";
            if (q.boxType === 'items') {
                try {
                    const items = JSON.parse(q.smartBoxData);
                    boxContent = items.map((it, i) => `${labels[i]}. ${it.text}`).join('<br>');
                } catch(e) { boxContent = "ë°ì´í„° ì˜¤ë¥˜"; }
            } else {
                boxContent = q.smartBoxData.replace(/\n/g, '<br>');
            }
            boxHTML = `<div style="background:#f9f9f9; border:1px solid #eee; padding:10px; margin:10px 0; font-size:0.9em;">${boxContent}</div>`;
        }

                // ì´ë¯¸ì§€ HTML
                // [ìˆ˜ì •ëœ ë¶€ë¶„] ì´ë¯¸ì§€ ìœ ë¬´ë¥¼ ì²´í¬í•˜ì—¬ HTML ìƒì„±
        let imgHTML = "";
        if (q.image && q.image.startsWith("data:image")) { 
            // ë°ì´í„°ê°€ ìœ íš¨í•œ base64 ì´ë¯¸ì§€ì¸ ê²½ìš°ì—ë§Œ ì¶œë ¥
            imgHTML = `
                <div class="list-image-container" style="margin: 10px 0;">
                    <img src="${q.image}" 
                        style="max-width: 100%; max-height: 250px; border: 1px solid #ddd; border-radius: 4px; display: block;" 
                        alt="ë¬¸ì œ ì´ë¯¸ì§€"
                        onerror="this.style.display='none';"> 
                </div>`;
        } else if (q.image) {
            // ì¼ë°˜ URL í˜•íƒœì¼ ê²½ìš°
            imgHTML = `<div style="margin: 10px 0;"><img src="${q.image}" style="max-width: 100%; max-height: 250px;"></div>`;
        }

        // ê°ê´€ì‹ ì„ ì§€ 1~5ë²ˆ í‘œì‹œ
        let optionsHTML = "";
        if (q.mainType === 'multiple' && q.options) {
            optionsHTML = '<div style="margin:10px 0; font-size:0.9em; color:#555;">';
            q.options.forEach((opt, i) => {
                if(opt) {
                    const isCorrect = (i === q.correct);
                    optionsHTML += `<div style="${isCorrect ? 'color:red; font-weight:bold;' : ''}">
                        ${['â‘ ','â‘¡','â‘¢','â‘£','â‘¤'][i]} ${opt} ${isCorrect ? 'âœ“' : ''}
                    </div>`;
                }
            });
            optionsHTML += '</div>';
        }

        // ì¹´ë“œ ë‚´ë¶€ êµ¬ì¡° ì¡°ë¦½
        card.innerHTML = `
            <div class="card-controls" style="position:absolute; top:10px; right:10px;">
                <button onclick="copyQuestion(${q.id})" style="padding:2px 8px;">ë³µì‚¬</button>
                <button onclick="editQuestion(${q.id})" style="padding:2px 8px;">ìˆ˜ì •</button>
                <button onclick="removeQuestion(${q.id})" style="color:red; padding:2px 8px;">ì‚­ì œ</button>
            </div>
            <div style="color:#888; font-size:0.8em; margin-bottom:5px;">
                #${q.tags.subject} #${q.tags.year}ë…„ #${q.tags.month}ì›” #${q.tags.number}ë²ˆ
            </div>
            <div style="font-size:1.1em; font-weight:bold; margin-bottom:10px;">${q.text}</div>
            ${imgHTML}
            ${boxHTML}
            ${optionsHTML}
            <div style="margin-top:10px; padding-top:10px; border-top:1px dashed #eee;">
                <span style="background:#eef; color:#33a; padding:2px 6px; border-radius:4px; font-weight:bold;">ì •ë‹µ: ${ansLabel}</span>
            </div>
            ${q.memo ? `<div style="margin-top:8px; font-size:0.85em; color:#666; font-style:italic;">ë©”ëª¨: ${q.memo}</div>` : ""}
        `;
        container.appendChild(card);
    });

    document.getElementById('q-count').innerText = filtered.length;
}

    function removeQuestion(id) { if(confirm("ì‚­ì œí• ê¹Œìš”?")) { questions = questions.filter(q => q.id !== id); renderList(); } }
    function downloadJSON() { 
        const blob = new Blob([JSON.stringify(questions, null, 2)], {type: 'application/json'});
        const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'data.json'; a.click(); 
    }
    function loadJSON(e) {
        const reader = new FileReader();
        reader.onload = (ev) => { questions = JSON.parse(ev.target.result); renderList(); };
        reader.readAsText(e.target.files[0]);
    }

    document.getElementById('image-input').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = (ev) => { currentImage = ev.target.result; updatePreview(); };
            reader.readAsDataURL(file);
        }
    });

function switchTab(tab) {
    const tabs = document.querySelectorAll('.tab');
    const contents = document.querySelectorAll('.tab-content');
    const indicator = document.getElementById('indicator');

    // 1. ëª¨ë“  í´ë˜ìŠ¤ ì´ˆê¸°í™”
    tabs.forEach(el => el.classList.remove('active'));
    contents.forEach(el => {
        el.classList.remove('active');
        el.style.display = 'none';
    });

    // 2. ì¸ë””ì¼€ì´í„° ìœ„ì¹˜ ê³„ì‚° (íƒ­ì´ 2ê°œì¸ ê²½ìš°)
    if (tab === 'live') {
        indicator.style.transform = 'translateX(0%)';
    } else if (tab === 'list') {
        indicator.style.transform = 'translateX(100%)'; // 50% ë„ˆë¹„ë§Œí¼ ì˜†ìœ¼ë¡œ ì´ë™
    }

    // 3. ì„ íƒëœ ìš”ì†Œ í™œì„±í™”
    const selectedTabBtn = document.getElementById('t-' + tab);
    const selectedContent = document.getElementById('tab-' + tab);

    if (selectedTabBtn && selectedContent) {
        selectedTabBtn.classList.add('active');
        selectedContent.style.display = 'block';
        setTimeout(() => {
            selectedContent.classList.add('active');
        }, 10);
    }

    if (tab === 'list') {
        renderList();
    }
}
    
    document.addEventListener('input', updatePreview);
</script>
</body>
</html>