<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>문제 만들기 도구 - 유형 선택형</title>
    <style>
        body { font-family: 'Pretendard', -apple-system, sans-serif; display: flex; margin: 0; height: 100vh; background: #f5f5f5; color: #333; }
        
        /* 좌측 편집기 */
        .editor { width: 50%; padding: 30px; overflow-y: auto; border-right: 2px solid #ddd; background: #fff; box-sizing: border-box; }
        h2 { border-bottom: 2px solid #333; padding-bottom: 10px; margin-top: 0; }
        .input-group { margin-bottom: 20px; }
        label { display: block; font-weight: bold; margin-bottom: 8px; font-size: 0.9em; color: #555; }
        
        /* 유형 선택 버튼 스타일 */
        .type-selector { display: flex; gap: 10px; margin-bottom: 20px; }
        .type-btn { flex: 1; padding: 10px; border: 1px solid #ccc; background: #fff; cursor: pointer; border-radius: 4px; font-weight: bold; }
        .type-btn.active { background: #4a90e2; color: white; border-color: #4a90e2; }

        textarea, input[type="text"] { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; font-size: 1em; }
        
        .option-item { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; }
        .option-item span { font-weight: bold; width: 25px; }
        
        .action-btns { display: flex; gap: 10px; margin-top: 30px; }
        button { padding: 12px 20px; cursor: pointer; border-radius: 4px; font-weight: bold; border: none; transition: 0.2s; font-size: 1em; }
        .btn-add { background: #4a90e2; color: white; width: 100%; margin: 15px 0; }
        .btn-secondary { background: #eee; color: #333; flex: 1; }

        /* 우측 영역 */
        .preview-container { width: 50%; display: flex; flex-direction: column; background: #fafafa; }
        .tabs { display: flex; border-bottom: 1px solid #ddd; background: #fff; }
        .tab { flex: 1; padding: 15px; text-align: center; cursor: pointer; font-weight: bold; color: #999; }
        .tab.active { color: #4a90e2; border-bottom: 3px solid #4a90e2; background: #fff; }

        .tab-content { flex: 1; padding: 30px; overflow-y: auto; display: none; }
        .tab-content.active { display: block; }

        .question-card { background: white; padding: 40px; border: 1px solid #ddd; box-shadow: 0 4px 6px rgba(0,0,0,0.05); position: relative; margin-bottom: 20px; }
        .remove-btn { position: absolute; top: 15px; right: 15px; color: #ccc; cursor: pointer; background: none; border: none; font-size: 1.5em; }
        .preview-img { max-width: 100%; margin: 15px 0; border-radius: 4px; }

        @media print { .editor, .tabs { display: none; } .preview-container, .tab-content { width: 100%; display: block !important; } }
    </style>
</head>
<body>

<div class="editor">
    <h2>문제 편집기</h2>
    
    <div class="input-group">
        <label>문제 유형 선택</label>
        <div class="type-selector">
            <button class="type-btn active" onclick="changeType('multiple')">오지선다</button>
            <button class="type-btn" onclick="changeType('short')">단답형</button>
        </div>
    </div>

    <div class="input-group">
        <label>문제 지문 (필수)</label>
        <textarea id="question-text" rows="4" placeholder="문제를 입력하세요..."></textarea>
    </div>

    <div class="input-group">
        <label>이미지 업로드 (선택)</label>
        <input type="file" id="image-input" accept="image/*">
    </div>

    <div id="multiple-choice-area" class="input-group">
        <label>5지선다 입력 및 정답 설정 (필수)</label>
        <div class="options">
            <div class="option-item"><input type="radio" name="correct" value="0"> <span>①</span><input type="text" class="opt" placeholder="보기 1번"></div>
            <div class="option-item"><input type="radio" name="correct" value="1"> <span>②</span><input type="text" class="opt" placeholder="보기 2번"></div>
            <div class="option-item"><input type="radio" name="correct" value="2"> <span>③</span><input type="text" class="opt" placeholder="보기 3번"></div>
            <div class="option-item"><input type="radio" name="correct" value="3"> <span>④</span><input type="text" class="opt" placeholder="보기 4번"></div>
            <div class="option-item"><input type="radio" name="correct" value="4"> <span>⑤</span><input type="text" class="opt" placeholder="보기 5번"></div>
        </div>
    </div>

    <div id="short-answer-area" class="input-group" style="display: none;">
        <label>정답 입력 (필수)</label>
        <input type="text" id="short-answer" placeholder="정답을 입력하세요">
    </div>

    <button class="btn-add" onclick="saveQuestion()">+ 현재 문제를 리스트에 추가</button>

    <div class="action-btns">
        <button class="btn-secondary" onclick="downloadJSON()">JSON 저장</button>
        <button class="btn-secondary" onclick="document.getElementById('file-upload').click()">불러오기</button>
        <button class="btn-secondary" onclick="window.print()">인쇄</button>
    </div>
    <input type="file" id="file-upload" style="display:none" accept=".json" onchange="loadJSON(event)">
</div>

<div class="preview-container">
    <div class="tabs">
        <div id="tab-live-btn" class="tab active" onclick="switchTab('live')">실시간 미리보기</div>
        <div id="tab-list-btn" class="tab" onclick="switchTab('list')">전체 리스트 (<span id="q-count">0</span>)</div>
    </div>

    <div id="tab-live" class="tab-content active">
        <div id="preview-box" class="question-card">
            <div id="p-type" style="font-size: 0.8em; color: #4a90e2; font-weight: bold; margin-bottom: 5px;">오지선다</div>
            <div id="p-question" style="font-size: 1.2em; font-weight: bold; margin-bottom: 10px;">문제를 입력하세요.</div>
            <img id="p-image" class="preview-img" style="display: none;">
            <div id="p-options-area">
                <ul id="p-options" style="list-style: none; padding: 0;"></ul>
            </div>
            <div id="p-short-area" style="display: none; margin-top: 15px; padding: 10px; background: #eee; border-radius: 4px;">
                <strong>정답:</strong> <span id="p-short-ans"></span>
            </div>
        </div>
    </div>

    <div id="tab-list" class="tab-content">
        <div id="question-list"></div>
    </div>
</div>

<script>
    let currentType = 'multiple'; // 'multiple' or 'short'
    let questions = [];
    let currentImage = "";

    function changeType(type) {
        currentType = type;
        document.querySelectorAll('.type-btn').forEach(btn => {
            btn.classList.toggle('active', btn.innerText.includes(type === 'multiple' ? '오지선다' : '단답형'));
        });
        document.getElementById('multiple-choice-area').style.display = (type === 'multiple' ? 'block' : 'none');
        document.getElementById('short-answer-area').style.display = (type === 'short' ? 'block' : 'none');
        updatePreview();
    }

    function switchTab(tab) {
        document.getElementById('tab-live').classList.toggle('active', tab === 'live');
        document.getElementById('tab-list').classList.toggle('active', tab === 'list');
        document.getElementById('tab-live-btn').classList.toggle('active', tab === 'live');
        document.getElementById('tab-list-btn').classList.toggle('active', tab === 'list');
        if(tab === 'list') renderList();
    }

    function updatePreview() {
        const qText = document.getElementById('question-text').value;
        document.getElementById('p-question').innerText = qText || "문제를 입력하세요.";
        document.getElementById('p-type').innerText = (currentType === 'multiple' ? '오지선다' : '단답형');

        if(currentType === 'multiple') {
            document.getElementById('p-options-area').style.display = 'block';
            document.getElementById('p-short-area').style.display = 'none';
            const pOptions = document.getElementById('p-options');
            const radioInputs = document.querySelectorAll('input[name="correct"]');
            const optInputs = document.querySelectorAll('.opt');
            const correctIdx = Array.from(radioInputs).find(r => r.checked)?.value;
            
            pOptions.innerHTML = '';
            optInputs.forEach((input, index) => {
                const li = document.createElement('li');
                li.style.marginBottom = '8px';
                if(correctIdx == index) li.style.color = '#4a90e2', li.style.fontWeight = 'bold';
                li.innerText = `${['①','②','③','④','⑤'][index]} ${input.value || '보기 ' + (index+1)}`;
                pOptions.appendChild(li);
            });
        } else {
            document.getElementById('p-options-area').style.display = 'none';
            document.getElementById('p-short-area').style.display = 'block';
            document.getElementById('p-short-ans').innerText = document.getElementById('short-answer').value || "정답 미입력";
        }
    }

    // 이미지 로직
    document.getElementById('image-input').addEventListener('change', function() {
        const file = this.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                currentImage = e.target.result;
                const img = document.getElementById('p-image');
                img.src = currentImage;
                img.style.display = 'block';
            };
            reader.readAsDataURL(file);
        }
    });

    function saveQuestion() {
        const textValue = document.getElementById('question-text').value.trim();
        if (!textValue) return alert("문제를 입력해주세요.");

        let questionData = {
            id: Date.now(),
            type: currentType,
            text: textValue,
            image: currentImage
        };

        if (currentType === 'multiple') {
            const opts = Array.from(document.querySelectorAll('.opt')).map(i => i.value.trim());
            const correct = Array.from(document.querySelectorAll('input[name="correct"]')).find(r => r.checked)?.value;
            if (opts.some(v => v === "")) return alert("5지선다를 모두 채워주세요.");
            if (correct === undefined) return alert("정답을 체크해주세요.");
            questionData.options = opts;
            questionData.correct = correct;
        } else {
            const ans = document.getElementById('short-answer').value.trim();
            if (!ans) return alert("정답을 입력해주세요.");
            questionData.answer = ans;
        }

        questions.push(questionData);
        document.getElementById('q-count').innerText = questions.length;
        resetForm();
        updatePreview();
        alert("리스트에 추가되었습니다.");
    }

    function resetForm() {
        document.getElementById('question-text').value = '';
        document.getElementById('image-input').value = '';
        currentImage = '';
        document.getElementById('p-image').style.display = 'none';
        document.querySelectorAll('.opt').forEach(i => i.value = '');
        document.querySelectorAll('input[name="correct"]').forEach(r => r.checked = false);
        document.getElementById('short-answer').value = '';
    }

    function renderList() {
        const listContainer = document.getElementById('question-list');
        listContainer.innerHTML = (questions.length === 0) ? '<p style="text-align:center;">저장된 문제가 없습니다.</p>' : '';
        
        questions.forEach((q, idx) => {
            const card = document.createElement('div');
            card.className = 'question-card';
            card.innerHTML = `
                <button class="remove-btn" onclick="removeQuestion(${q.id})">&times;</button>
                <div style="font-weight:bold; color:#4a90e2; margin-bottom:10px;">문항 ${idx + 1} (${q.type === 'multiple' ? '오지선다' : '단답형'})</div>
                <div style="font-size:1.1em; font-weight:bold; white-space:pre-wrap;">${q.text}</div>
                ${q.image ? `<img src="${q.image}" class="preview-img">` : ''}
                ${q.type === 'multiple' ? 
                    `<ul style="list-style:none; padding:0; margin-top:10px;">${q.options.map((o, i) => `<li style="${q.correct == i ? 'color:#4a90e2; font-weight:bold;' : ''}">${['①','②','③','④','⑤'][i]} ${o}</li>`).join('')}</ul>` : 
                    `<div style="margin-top:15px; padding:10px; background:#f0f0f0; border-radius:4px;"><strong>정답:</strong> ${q.answer}</div>`
                }
            `;
            listContainer.appendChild(card);
        });
    }

    function removeQuestion(id) {
        if(confirm("삭제할까요?")) {
            questions = questions.filter(q => q.id !== id);
            document.getElementById('q-count').innerText = questions.length;
            renderList();
        }
    }

    function downloadJSON() {
        const blob = new Blob([JSON.stringify(questions, null, 2)], {type: 'application/json'});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'my_test.json';
        a.click();
    }

    function loadJSON(e) {
        const reader = new FileReader();
        reader.onload = (event) => {
            questions = JSON.parse(event.target.result);
            document.getElementById('q-count').innerText = questions.length;
            switchTab('list');
        };
        reader.readAsText(e.target.files[0]);
    }

    // 이벤트 바인딩
    document.getElementById('question-text').addEventListener('input', updatePreview);
    document.getElementById('short-answer').addEventListener('input', updatePreview);
    document.querySelectorAll('.opt').forEach(i => i.addEventListener('input', updatePreview));
    document.querySelectorAll('input[name="correct"]').forEach(i => i.addEventListener('change', updatePreview));
</script>

</body>
</html>